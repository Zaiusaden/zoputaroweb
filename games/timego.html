<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Go! - Juego</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Black', Impact, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0d1a 25%, #2d1b2d 50%, #1a0d2d 75%, #0a0a0a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            overflow-x: hidden;
            position: relative;
        }

            /* Efectos de fondo m√°s elegantes */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.06) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(255, 20, 147, 0.06) 0%, transparent 50%), radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.04) 0%, transparent 70%);
                pointer-events: none;
                z-index: -1;
            }

        .container {
            background: rgba(10, 10, 10, 0.95);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8), 0 0 0 2px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            width: 95vw;
            max-width: 450px;
            max-height: 96vh;
            text-align: center;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .screen {
            display: none;
            flex: 1;
            animation: slideIn 0.3s ease-out;
            overflow-y: auto;
            padding: 5px;
        }

            .screen.active {
                display: flex;
                flex-direction: column;
            }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Botones de navegaci√≥n integrados */
        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .nav-btn {
            padding: 8px 12px;
            font-size: 0.8rem;
            border-radius: 8px;
            min-width: 80px;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 800;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-back {
            background: linear-gradient(145deg, #4a4a4a, #2a2a2a);
            color: #ffffff;
            border-color: #666;
            box-shadow: 0 3px 8px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.2);
        }

            .nav-back:hover {
                background: linear-gradient(145deg, #6a6a6a, #4a4a4a);
                border-color: #888;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.3);
            }

        .nav-exit {
            background: linear-gradient(145deg, #dc2626, #991b1b);
            color: #ffffff;
            border-color: #ef4444;
            box-shadow: 0 3px 8px rgba(220, 38, 38, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        }

            .nav-exit:hover {
                background: linear-gradient(145deg, #ef4444, #dc2626);
                border-color: #f87171;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6), inset 0 1px 0 rgba(255,255,255,0.3);
            }

        /* T√çTULO m√°s impactante */
        h1 {
            background: linear-gradient(45deg, #ffd700, #ff1493, #8a2be2, #00ff7f, #ffd700);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: clamp(2.2rem, 12vw, 3.8rem);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 0.8rem;
            color: #fff;
            filter: drop-shadow(0 6px 12px rgba(255, 215, 0, 0.4));
            animation: gradientShift 4s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* T√≠tulos de secci√≥n m√°s definidos */
        h2 {
            color: #ffd700;
            font-size: clamp(1.4rem, 6vw, 1.9rem);
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 0.8rem;
            text-shadow: 0 3px 6px rgba(255, 215, 0, 0.5), 2px 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 2px;
            border-bottom: 3px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: #ff1493;
            font-size: clamp(1rem, 4vw, 1.3rem);
            font-weight: 800;
            margin-bottom: 0.8rem;
            text-shadow: 0 2px 8px rgba(255, 20, 147, 0.5), 1px 1px 3px rgba(0,0,0,0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* CONFIGURACI√ìN INICIAL VERTICAL */
        .setup-grid {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin: 1.2rem 0;
        }

        /* Botones m√°s definidos y profesionales */
        .btn {
            background: linear-gradient(145deg, #ff1493, #c2185b);
            color: white;
            border: 2px solid #ff1493;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            font-weight: 800;
            cursor: pointer;
            margin: 0.3rem 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            text-shadow: 0 1px 2px rgba(0,0,0,0.7);
            position: relative;
            overflow: hidden;
        }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s;
            }

            .btn:hover::before {
                left: 100%;
            }

            .btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(255, 20, 147, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.4);
                background: linear-gradient(145deg, #ff1493, #e91e63);
                border-color: #ff6bb3;
            }

            .btn:active {
                transform: translateY(-1px);
                box-shadow: 0 4px 15px rgba(255, 20, 147, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

        .btn-success {
            background: linear-gradient(145deg, #10b981, #047857);
            border-color: #10b981;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

            .btn-success:hover {
                background: linear-gradient(145deg, #34d399, #10b981);
                border-color: #6ee7b7;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.4);
            }

        .btn-warning {
            background: linear-gradient(145deg, #f59e0b, #d97706);
            border-color: #f59e0b;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

            .btn-warning:hover {
                background: linear-gradient(145deg, #fbbf24, #f59e0b);
                border-color: #fcd34d;
                box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.4);
            }

        .btn-danger {
            background: linear-gradient(145deg, #dc2626, #991b1b);
            border-color: #dc2626;
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #6b7280, #4b5563);
            border-color: #6b7280;
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

            .btn-secondary:hover {
                background: linear-gradient(145deg, #9ca3af, #6b7280);
                border-color: #d1d5db;
            }

        .btn-large {
            padding: 18px 32px;
            font-size: clamp(1.1rem, 5vw, 1.4rem);
            border-radius: 16px;
            letter-spacing: 2px;
        }

        /* Campos de entrada m√°s elegantes */
        .input-group {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.2rem;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

            .input-group:hover {
                background: rgba(255, 255, 255, 0.12);
                border-color: rgba(255, 215, 0, 0.5);
                box-shadow: 0 4px 20px rgba(255, 215, 0, 0.2);
            }

            .input-group label {
                color: #ffd700;
                font-weight: 800;
                margin-bottom: 0.8rem;
                font-size: clamp(1rem, 4vw, 1.2rem);
                display: block;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-shadow: 0 1px 3px rgba(0,0,0,0.7);
            }

        input, select {
            padding: 14px 16px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 10px;
            font-size: clamp(0.9rem, 4vw, 1rem);
            margin: 0.4rem 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

            input:focus, select:focus {
                outline: none;
                border-color: #ffd700;
                background: #fff;
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.4), inset 0 2px 4px rgba(0,0,0,0.1);
                transform: translateY(-1px);
            }

            input::placeholder {
                color: #666;
                font-weight: 500;
            }

            select option {
                background: #fff;
                color: #333;
                font-weight: 600;
            }

        .player-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 1rem 0;
        }

        .player-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

            .player-item:hover {
                border-color: #ffd700;
                background: rgba(255, 255, 255, 0.15);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2);
            }

        /* TIMER m√°s impactante */
        .timer {
            font-size: clamp(3.5rem, 18vw, 5.5rem);
            font-weight: 900;
            color: #10b981;
            margin: 0.8rem 0;
            font-family: 'Impact', monospace;
            letter-spacing: 3px;
            text-shadow: 0 6px 20px rgba(16, 185, 129, 0.6), 0 0 40px rgba(16, 185, 129, 0.4);
            border: 3px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            background: rgba(16, 185, 129, 0.1);
        }

            .timer.warning {
                color: #f59e0b;
                border-color: rgba(245, 158, 11, 0.5);
                background: rgba(245, 158, 11, 0.1);
                text-shadow: 0 6px 20px rgba(245, 158, 11, 0.6), 0 0 40px rgba(245, 158, 11, 0.4);
                animation: pulse 0.8s infinite;
            }

            .timer.danger {
                color: #dc2626;
                border-color: rgba(220, 38, 38, 0.7);
                background: rgba(220, 38, 38, 0.15);
                text-shadow: 0 6px 20px rgba(220, 38, 38, 0.8), 0 0 40px rgba(220, 38, 38, 0.6);
                animation: shake 0.5s infinite;
            }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-6px);
            }

            75% {
                transform: translateX(6px);
            }
        }

        /* PALABRA CENTRAL m√°s destacada */
        .current-word {
            font-size: clamp(2rem, 11vw, 3.8rem);
            font-weight: 900;
            color: #fff;
            margin: 1.2rem 0;
            padding: 1.5rem;
            background: linear-gradient(145deg, rgba(255, 20, 147, 0.2), rgba(138, 43, 226, 0.2));
            border-radius: 20px;
            border: 3px solid rgba(255, 215, 0, 0.6);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            animation: wordPop 0.5s ease-out;
            text-transform: uppercase;
            letter-spacing: 3px;
            flex: 1;
            text-shadow: 0 4px 15px rgba(255, 255, 255, 0.3), 2px 2px 6px rgba(0,0,0,0.8);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        @keyframes wordPop {
            0% {
                transform: scale(0.9);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Elementos informativos m√°s claros */
        .game-info {
            background: rgba(16, 185, 129, 0.2);
            padding: 1rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            border: 2px solid rgba(16, 185, 129, 0.5);
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.2rem 0;
            border-radius: 12px;
            overflow: hidden;
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }

            .score-table th, .score-table td {
                padding: 1rem;
                text-align: center;
                font-weight: 700;
            }

            .score-table th {
                background: linear-gradient(145deg, #ff1493, #c2185b);
                color: white;
                font-weight: 900;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-shadow: 0 1px 3px rgba(0,0,0,0.7);
            }

            .score-table tr:nth-child(even) {
                background: rgba(255, 255, 255, 0.1);
            }

            .score-table tr:hover {
                background: rgba(255, 215, 0, 0.1);
            }

        .round-info {
            background: rgba(245, 158, 11, 0.2);
            padding: 1rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            border: 2px solid rgba(245, 158, 11, 0.5);
            font-size: clamp(0.8rem, 3.5vw, 1rem);
            font-weight: 700;
            backdrop-filter: blur(5px);
        }

        .words-remaining {
            font-size: clamp(1.1rem, 5vw, 1.4rem);
            color: #34d399;
            font-weight: 900;
            text-shadow: 0 3px 10px rgba(52, 211, 153, 0.5), 0 1px 3px rgba(0,0,0,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .team-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            color: white;
            font-size: clamp(0.7rem, 3vw, 0.9rem);
            margin-left: 0.5rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid;
            text-shadow: 0 1px 2px rgba(0,0,0,0.7);
        }

        .team-a {
            background: linear-gradient(145deg, #10b981, #047857);
            border-color: #34d399;
        }

        .team-b {
            background: linear-gradient(145deg, #dc2626, #991b1b);
            border-color: #f87171;
        }

        .team-c {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            border-color: #a78bfa;
        }

        .winner {
            background: linear-gradient(145deg, #10b981, #047857);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin: 1.5rem 0;
            font-size: clamp(1.2rem, 5vw, 1.6rem);
            font-weight: 900;
            animation: celebrate 2s ease-in-out infinite alternate;
            border: 3px solid #34d399;
            text-shadow: 0 2px 6px rgba(0,0,0,0.7);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        @keyframes celebrate {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.03);
            }
        }

        /* REGLAS m√°s legibles */
        .rules-box {
            background: rgba(6, 182, 212, 0.15);
            padding: 1rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            text-align: left;
            border: 2px solid rgba(6, 182, 212, 0.5);
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            backdrop-filter: blur(5px);
        }

            .rules-box h4 {
                margin-bottom: 0.5rem;
                color: #22d3ee;
                font-size: clamp(0.9rem, 3.5vw, 1.1rem);
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-shadow: 0 1px 3px rgba(0,0,0,0.7);
            }

        .word-input-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.8rem;
            border-radius: 16px;
            margin: 1.2rem 0;
            border: 2px solid rgba(255, 215, 0, 0.4);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .current-turn-info {
            background: rgba(6, 182, 212, 0.2);
            padding: 1.8rem;
            border-radius: 16px;
            margin: 1.2rem 0;
            border: 2px solid rgba(6, 182, 212, 0.5);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 215, 0, 0.15);
            border-radius: 50%;
            animation: float 10s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.4;
            }

            50% {
                transform: translateY(-30px) rotate(180deg);
                opacity: 0.8;
            }
        }

        .game-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 0.8rem 0;
        }

        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 0.8rem 0;
        }

        /* LAYOUT optimizado */
        .game-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 0.5rem;
        }

        /* ==== NUEVOS ESTILOS PARA LISTA DE JUGADORES ==== */

        /* Lista compacta de jugadores */
        .players-status {
            background: rgba(255, 255, 255, 0.08);
            padding: 0.8rem;
            border-radius: 12px;
            margin: 0.8rem 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(5px);
        }

        .players-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            justify-content: center;
        }

        .player-status-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: clamp(0.8rem, 3.5vw, 0.9rem);
            font-weight: 700;
            transition: all 0.3s ease;
            min-width: fit-content;
        }

            .player-status-item.completed {
                background: rgba(16, 185, 129, 0.2);
                border: 1px solid rgba(16, 185, 129, 0.6);
                color: #34d399;
            }

            .player-status-item.current {
                background: rgba(255, 20, 147, 0.25);
                border: 2px solid #ff1493;
                color: #ffd700;
            }

            .player-status-item.pending {
                background: rgba(107, 114, 128, 0.15);
                border: 1px solid rgba(107, 114, 128, 0.4);
                color: #9ca3af;
            }

        .status-icon {
            font-size: 1rem;
        }

        /* Contador mejorado manteniendo estilo original */
        .word-counter {
            background: rgba(245, 158, 11, 0.2);
            padding: 0.8rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            border: 2px solid rgba(245, 158, 11, 0.5);
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            font-weight: 700;
            backdrop-filter: blur(5px);
        }

        .big-number {
            color: #ffd700;
            font-size: 1.3em;
            font-weight: 900;
            text-shadow: 0 2px 6px rgba(255, 215, 0, 0.6);
        }

        /* Botones de palabras */
        .word-buttons {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

            .word-buttons .btn {
                flex: 1;
                margin: 0;
            }

        /* Responsive mejorado */
        @media (max-height: 600px) {
            .container {
                padding: 0.8rem;
                max-height: 98vh;
            }

            h1 {
                font-size: clamp(1.8rem, 8vw, 2.5rem);
                margin-bottom: 0.6rem;
            }

            .current-word {
                min-height: 90px;
                font-size: clamp(1.6rem, 10vw, 3.2rem);
                margin: 1rem 0;
                padding: 1.2rem;
            }

            .timer {
                font-size: clamp(3rem, 15vw, 4.8rem);
                margin: 0.6rem 0;
            }

            .btn {
                padding: 12px 20px;
            }

            .btn-large {
                padding: 16px 24px;
                font-size: clamp(1rem, 4vw, 1.3rem);
            }

            .nav-btn {
                padding: 6px 10px;
                font-size: 0.75rem;
                min-width: 70px;
            }
        }

        @media (max-width: 400px) {
            .container {
                padding: 0.8rem;
            }

            .nav-btn {
                padding: 6px 8px;
                font-size: 0.7rem;
                min-width: 60px;
            }

            .header-nav {
                gap: 0.5rem;
            }

            .players-list {
                gap: 0.2rem;
            }

            .player-status-item {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>

    <div class="container">
        <!-- Pantalla inicial -->
        <div class="screen active" id="setupScreen">
            <h1>Time Go!</h1>

            <div class="setup-grid">
                <div class="input-group">
                    <label>üéÆ Jugadores</label>
                    <select id="numPlayers">
                        <option value="3">3 (sin equipos)</option>
                        <option value="4">4 (2 equipos de 2)</option>
                        <option value="5">5 (sin equipos)</option>
                        <option value="6a">6 (2 equipos de 3)</option>
                        <option value="6b">6 (3 equipos de 2)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>üìù Palabras/jugador</label>
                    <select id="wordsPerPlayer">
                        <option value="6">6 palabras</option>
                        <option value="7">7 palabras</option>
                        <option value="8">8 palabras</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>‚è∞ Tiempo/turno</label>
                    <select id="turnTime">
                        <option value="30">30 seg</option>
                        <option value="45">45 seg</option>
                        <option value="60">60 seg</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-large" onclick="setupPlayers()">Configurar Jugadores</button>
        </div>

        <!-- Configuraci√≥n de jugadores -->
        <div class="screen" id="playersScreen">
            <div id="playersSetup"></div>
            <div class="navigation-buttons">
                <button class="btn btn-secondary" onclick="showScreen('setupScreen')">‚¨ÖÔ∏è Atr√°s</button>
            </div>
        </div>

        <!-- Entrada de palabras -->
        <div class="screen" id="wordsScreen">
            <div class="header-nav">
                <button class="nav-btn nav-back" onclick="backToPlayersSetup()">‚¨ÖÔ∏è Atr√°s</button>
                <button class="nav-btn nav-exit" onclick="exitToMenu()">üè† Men√∫</button>
            </div>

            <h2>Introducir Palabras</h2>

            <!-- NUEVA: Lista compacta de jugadores -->
            <div class="players-status" id="playersStatusSection">
                <h3>Estado Jugadores</h3>
                <div class="players-list" id="playersList">
                    <!-- Se genera din√°micamente -->
                </div>
            </div>

            <!-- Game info mejorada manteniendo estilo original -->
            <div class="game-info">
                <strong id="currentWordPlayer"></strong>
            </div>

            <!-- Contador mejorado -->
            <div class="word-counter">
                Palabra <span class="big-number" id="wordNumber"></span> de <span class="big-number" id="totalWords"></span>
            </div>

            <div class="word-input-section">
                <input type="text" id="wordInput" placeholder="Escribe una palabra o nombre..." maxlength="50">

                <!-- NUEVOS: Botones de palabras con deshacer -->
                <div class="word-buttons">
                    <button class="btn btn-warning" onclick="undoLastWord()" id="undoBtn" style="display:none;">‚Ü∂ Deshacer</button>
                    <button class="btn" onclick="addWord()">‚ûï A√±adir</button>
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-success btn-large" onclick="startGame()" id="startGameBtn" style="display:none;">üéÆ ¬°Comenzar!</button>
            </div>
        </div>

        <!-- Pantalla entre rondas -->
        <div class="screen" id="betweenRoundsScreen">
            <div class="header-nav">
                <div></div>
                <button class="nav-btn nav-exit" onclick="exitToMenu()">üè† Men√∫</button>
            </div>

            <h2 id="roundEndTitle">Fin de Ronda</h2>
            <div id="roundScores"></div>
            <div class="navigation-buttons">
                <button class="btn btn-success btn-large" onclick="startNextRound()" id="nextRoundBtn">‚ñ∂Ô∏è Siguiente</button>
                <button class="btn btn-large" onclick="showFinalResults()" id="finalResultsBtn" style="display:none;">üèÜ Resultados</button>
            </div>
        </div>

        <!-- Pantalla de preparaci√≥n de turno -->
        <div class="screen" id="turnPrepScreen">
            <div class="header-nav">
                <div></div>
                <button class="nav-btn nav-exit" onclick="exitToMenu()">üè† Men√∫</button>
            </div>

            <h2>Preparar Turno</h2>
            <div class="current-turn-info">
                <h3 id="turnPlayerInfo"></h3>
                <div id="turnRules"></div>
            </div>
            <button class="btn btn-success btn-large" onclick="startTurn()">üéØ ¬°Comenzar!</button>
        </div>

        <!-- Pantalla de juego -->
        <div class="screen" id="gameScreen">
            <div class="header-nav">
                <div></div>
                <button class="nav-btn nav-exit" onclick="exitToMenu()">üè† Men√∫</button>
            </div>

            <div class="game-layout">
                <div class="round-info">
                    <h3 id="roundTitle"></h3>
                    <p id="roundDescription"></p>
                    <div class="game-info">
                        <strong id="currentPlayer"></strong>
                        <div class="words-remaining">Quedan: <span id="wordsLeft"></span></div>
                    </div>
                </div>

                <div class="timer" id="timer">30</div>

                <div class="current-word" id="currentWordDisplay">Preparando...</div>

                <div class="game-buttons">
                    <button class="btn btn-success btn-large" onclick="wordGuessed()" id="guessedBtn">‚úÖ Acert√≥</button>
                    <button class="btn btn-warning btn-large" onclick="passWord()" id="passBtn" style="display:none;">‚è≠Ô∏è Pasar</button>
                </div>
            </div>
        </div>

        <!-- Pantalla de resultados finales -->
        <div class="screen" id="resultsScreen">
            <h2>üèÜ Resultados Finales</h2>
            <div id="finalScores"></div>
            <div id="winnerAnnouncement"></div>
            <button class="btn btn-large" onclick="restartGame()">üîÑ Nuevo Juego</button>
        </div>
    </div>

    <script>
        // ===== VARIABLES GLOBALES =====
        let gameState = {
            players: [],
            teams: [],
            isTeamGame: false,
            teamConfig: null, // '2x2', '2x3', '3x2'
            wordsPerPlayer: 6,
            turnTime: 30,
            currentRound: 1,
            currentPlayerIndex: 0,
            currentTurnIndex: 0,
            allWords: [],
            remainingWords: [],
            currentWord: null,
            scores: {},
            timer: null,
            timeLeft: 30,
            isPlaying: false,
            roundWords: { 1: [], 2: [], 3: [] },
            turnOrder: [],
            audioContext: null,
            hasPlayedWarningSound: false
        };

        const roundRules = {
            1: {
                title: "üó£Ô∏è Ronda 1: Descripci√≥n Libre",
                description: "Describe sin decir la palabra. NO SE PUEDE PASAR.",
                canPass: false
            },
            2: {
                title: "‚òùÔ∏è Ronda 2: Una Palabra",
                description: "Solo UNA palabra de pista. S√ç se puede pasar.",
                canPass: true
            },
            3: {
                title: "ü§π Ronda 3: M√≠mica",
                description: "Solo gestos, sin hablar. S√ç se puede pasar.",
                canPass: true
            }
        };

        // ===== FUNCIONES DE AUDIO MEJORADAS =====
        function initAudioContext() {
            if (!gameState.audioContext) {
                try {
                    gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio context no disponible');
                }
            }
        }

        function playBeepSound() {
            try {
                initAudioContext();
                if (!gameState.audioContext) return;

                const oscillator = gameState.audioContext.createOscillator();
                const gainNode = gameState.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(gameState.audioContext.destination);

                oscillator.frequency.setValueAtTime(800, gameState.audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, gameState.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, gameState.audioContext.currentTime + 0.3);

                oscillator.start(gameState.audioContext.currentTime);
                oscillator.stop(gameState.audioContext.currentTime + 0.3);
            } catch (error) {
                console.log('Error reproduciendo sonido:', error);
            }
        }

        // NUEVO: Sonido distintivo para tiempo agotado
        function playTimeUpSound() {
            try {
                initAudioContext();
                if (!gameState.audioContext) return;

                // Secuencia de tres beeps largos y graves
                const times = [0, 0.3, 0.6];
                times.forEach((time) => {
                    const oscillator = gameState.audioContext.createOscillator();
                    const gainNode = gameState.audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(gameState.audioContext.destination);

                    // Frecuencia m√°s grave y duraci√≥n m√°s larga
                    oscillator.frequency.setValueAtTime(400, gameState.audioContext.currentTime + time);
                    gainNode.gain.setValueAtTime(0.5, gameState.audioContext.currentTime + time);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, gameState.audioContext.currentTime + time + 0.8);

                    oscillator.start(gameState.audioContext.currentTime + time);
                    oscillator.stop(gameState.audioContext.currentTime + time + 0.8);
                });
            } catch (error) {
                console.log('Error reproduciendo sonido de tiempo agotado:', error);
            }
        }

        // ===== FUNCIONES DE EFECTOS VISUALES =====
        function createFloatingParticles() {
            const particles = document.getElementById('particles');
            particles.innerHTML = '';

            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = (Math.random() * 6 + 4) + 'px';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (Math.random() * 5 + 5) + 's';
                particles.appendChild(particle);
            }
        }

        // ===== FUNCIONES DE NAVEGACI√ìN =====
        function exitToMenu() {
            if (confirm('¬øVolver al men√∫? Se perder√° el progreso actual.')) {
                restartGame();
            }
        }

        function backToPlayersSetup() {
            showScreen('playersScreen');
            const setupHTML = document.getElementById('playersSetup').innerHTML;
            if (!setupHTML || setupHTML.trim() === '') {
                setupPlayers();
            }
        }

        // ===== NUEVAS FUNCIONES PARA LISTA DE JUGADORES =====

        // NUEVA: Generar y actualizar lista de jugadores
        function updatePlayersStatus() {
            const playersList = document.getElementById('playersList');
            if (!playersList) return;

            let playersHTML = '';

            gameState.players.forEach((player, index) => {
                let statusClass, statusIcon;

                if (index < gameState.currentPlayerIndex) {
                    statusClass = 'completed';
                    statusIcon = '‚úÖ';
                } else if (index === gameState.currentPlayerIndex) {
                    statusClass = 'current';
                    statusIcon = 'üìù';
                } else {
                    statusClass = 'pending';
                    statusIcon = '‚è≥';
                }

                playersHTML += `
                        <div class="player-status-item ${statusClass}">
                            <span>${player.name}</span>
                            <span class="status-icon">${statusIcon}</span>
                        </div>
                    `;
            });

            playersList.innerHTML = playersHTML;
        }

        // NUEVA: Funci√≥n para deshacer √∫ltima palabra
        function undoLastWord() {
            if (gameState.allWords.length === 0) {
                return;
            }

            // Quitar la √∫ltima palabra
            const removedWord = gameState.allWords.pop();
            gameState.currentWordCount--;

            console.log('Palabra eliminada:', removedWord, 'Total restante:', gameState.allWords.length);

            // Verificar si necesitamos retroceder al jugador anterior
            const wordsForThisPlayer = gameState.currentWordCount % gameState.wordsPerPlayer;

            if (wordsForThisPlayer === gameState.wordsPerPlayer - 1 && gameState.currentPlayerIndex > 0) {
                // La palabra eliminada era la primera del jugador actual, volver al anterior
                gameState.currentPlayerIndex--;
                console.log('Retrocediendo al jugador:', gameState.players[gameState.currentPlayerIndex].name);
            }

            // Si todos hab√≠an terminado, restaurar la interfaz de entrada
            if (gameState.currentPlayerIndex >= gameState.players.length) {
                gameState.currentPlayerIndex = gameState.players.length - 1;
                // Restaurar elementos que se ocultaron
                document.querySelector('.word-input-section').style.display = 'flex';
                document.querySelector('.word-counter').style.display = 'block';
                document.getElementById('startGameBtn').style.display = 'none';
            }

            // Actualizar UI
            showWordEntry();

            // Ocultar bot√≥n deshacer si no hay palabras
            if (gameState.allWords.length === 0) {
                document.getElementById('undoBtn').style.display = 'none';
            }
        }

        // ===== FUNCIONES DE CONFIGURACI√ìN =====
        function setupPlayers() {
            const numPlayersStr = document.getElementById('numPlayers').value;
            const wordsPerPlayer = parseInt(document.getElementById('wordsPerPlayer').value);
            const turnTime = parseInt(document.getElementById('turnTime').value);

            console.log('=== SETUP PLAYERS ===');
            console.log('Configuraci√≥n:', numPlayersStr, 'palabras:', wordsPerPlayer, 'tiempo:', turnTime);

            // RESETEAR TODO EL ESTADO
            gameState = {
                players: [],
                teams: [],
                isTeamGame: false,
                teamConfig: null,
                wordsPerPlayer: wordsPerPlayer,
                turnTime: turnTime,
                currentRound: 1,
                currentPlayerIndex: 0,
                currentTurnIndex: 0,
                allWords: [],
                remainingWords: [],
                currentWord: null,
                scores: {},
                timer: null,
                timeLeft: turnTime,
                isPlaying: false,
                roundWords: { 1: [], 2: [], 3: [] },
                turnOrder: [],
                audioContext: gameState.audioContext,
                hasPlayedWarningSound: false
            };

            // Determinar configuraci√≥n de equipos
            let numPlayers;
            if (numPlayersStr === '4') {
                numPlayers = 4;
                gameState.isTeamGame = true;
                gameState.teamConfig = '2x2';
            } else if (numPlayersStr === '6a') {
                numPlayers = 6;
                gameState.isTeamGame = true;
                gameState.teamConfig = '2x3';
            } else if (numPlayersStr === '6b') {
                numPlayers = 6;
                gameState.isTeamGame = true;
                gameState.teamConfig = '3x2';
            } else {
                numPlayers = parseInt(numPlayersStr);
                gameState.isTeamGame = false;
                gameState.teamConfig = null;
            }

            console.log('Configuraci√≥n final:', {
                numPlayers,
                isTeamGame: gameState.isTeamGame,
                teamConfig: gameState.teamConfig
            });

            let setupHTML = '';

            if (gameState.isTeamGame) {
                if (gameState.teamConfig === '2x2') {
                    setupHTML += '<h3>üèÜ 2 Equipos de 2</h3>';
                    setupHTML += '<div class="input-group">';
                    setupHTML += '<input type="text" id="teamAName" placeholder="Equipo A" value="Equipo A">';
                    setupHTML += '<input type="text" id="teamBName" placeholder="Equipo B" value="Equipo B">';
                    setupHTML += '</div>';

                    setupHTML += '<div class="player-list">';
                    for (let i = 0; i < 4; i++) {
                        const team = i < 2 ? 'A' : 'B';
                        setupHTML += `
                                                    <div class="player-item">
                                                        <input type="text" id="player${i}" placeholder="Jugador ${i + 1}" required>
                                                        <span class="team-badge team-${team.toLowerCase()}">Equipo ${team}</span>
                                                    </div>
                                                `;
                    }
                    setupHTML += '</div>';

                } else if (gameState.teamConfig === '2x3') {
                    setupHTML += '<h3>üèÜ 2 Equipos de 3</h3>';
                    setupHTML += '<div class="input-group">';
                    setupHTML += '<input type="text" id="teamAName" placeholder="Equipo A" value="Equipo A">';
                    setupHTML += '<input type="text" id="teamBName" placeholder="Equipo B" value="Equipo B">';
                    setupHTML += '</div>';

                    setupHTML += '<div class="player-list">';
                    for (let i = 0; i < 6; i++) {
                        const team = i < 3 ? 'A' : 'B';
                        setupHTML += `
                                                    <div class="player-item">
                                                        <input type="text" id="player${i}" placeholder="Jugador ${i + 1}" required>
                                                        <span class="team-badge team-${team.toLowerCase()}">Equipo ${team}</span>
                                                    </div>
                                                `;
                    }
                    setupHTML += '</div>';

                } else if (gameState.teamConfig === '3x2') {
                    setupHTML += '<h3>üèÜ 3 Equipos de 2</h3>';
                    setupHTML += '<div class="input-group">';
                    setupHTML += '<input type="text" id="teamAName" placeholder="Equipo A" value="Equipo A">';
                    setupHTML += '<input type="text" id="teamBName" placeholder="Equipo B" value="Equipo B">';
                    setupHTML += '<input type="text" id="teamCName" placeholder="Equipo C" value="Equipo C">';
                    setupHTML += '</div>';

                    setupHTML += '<div class="player-list">';
                    for (let i = 0; i < 6; i++) {
                        const team = i < 2 ? 'A' : i < 4 ? 'B' : 'C';
                        setupHTML += `
                                                    <div class="player-item">
                                                        <input type="text" id="player${i}" placeholder="Jugador ${i + 1}" required>
                                                        <span class="team-badge team-${team.toLowerCase()}">Equipo ${team}</span>
                                                    </div>
                                                `;
                    }
                    setupHTML += '</div>';
                }
            } else {
                setupHTML += '<h2>Configurar Jugadores</h2>';
                setupHTML += '<div class="player-list">';
                for (let i = 0; i < numPlayers; i++) {
                    setupHTML += `
                                                <div class="player-item">
                                                    <input type="text" id="player${i}" placeholder="Jugador ${i + 1}" required>
                                                </div>
                                            `;
                }
                setupHTML += '</div>';
            }

            // AQU√ç EST√Å EL CAMBIO PRINCIPAL: Los botones ahora se generan din√°micamente
            setupHTML += '<br><button class="btn" onclick="validatePlayers()">‚úÖ Confirmar</button>';
            setupHTML += '<button class="btn btn-success btn-large" onclick="startWordEntry()" id="startWordBtn" style="display:none;">üìù Introducir Palabras</button>';

            document.getElementById('playersSetup').innerHTML = setupHTML;

            showScreen('playersScreen');

            setTimeout(() => {
                const firstInput = document.getElementById('player0');
                if (firstInput) {
                    firstInput.focus();
                }
            }, 100);
        }

        function validatePlayers() {
            const numPlayersStr = document.getElementById('numPlayers').value;
            let numPlayers;

            if (numPlayersStr === '4') numPlayers = 4;
            else if (numPlayersStr === '6a' || numPlayersStr === '6b') numPlayers = 6;
            else numPlayers = parseInt(numPlayersStr);

            console.log('=== VALIDATE PLAYERS ===');
            console.log('Validando', numPlayers, 'jugadores, configuraci√≥n:', gameState.teamConfig);

            // Recoger nombres de jugadores
            for (let i = 0; i < numPlayers; i++) {
                const playerInput = document.getElementById(`player${i}`);
                if (!playerInput) {
                    alert(`Error: No se pudo encontrar el campo del jugador ${i + 1}`);
                    return;
                }
                const playerName = playerInput.value.trim();
                if (!playerName) {
                    alert(`Por favor, introduce el nombre del jugador ${i + 1}`);
                    return;
                }

                let teamId = null;
                if (gameState.teamConfig === '2x2') {
                    teamId = i < 2 ? 'A' : 'B';
                } else if (gameState.teamConfig === '2x3') {
                    teamId = i < 3 ? 'A' : 'B';
                } else if (gameState.teamConfig === '3x2') {
                    teamId = i < 2 ? 'A' : i < 4 ? 'B' : 'C';
                }

                gameState.players.push({
                    name: playerName,
                    team: teamId
                });
            }

            console.log('Jugadores configurados:', gameState.players);

            // Configurar equipos y scores
            if (gameState.isTeamGame) {
                if (gameState.teamConfig === '3x2') {
                    const teamAName = document.getElementById('teamAName').value.trim() || 'Equipo A';
                    const teamBName = document.getElementById('teamBName').value.trim() || 'Equipo B';
                    const teamCName = document.getElementById('teamCName').value.trim() || 'Equipo C';

                    gameState.teams = [
                        { name: teamAName, id: 'A' },
                        { name: teamBName, id: 'B' },
                        { name: teamCName, id: 'C' }
                    ];

                    gameState.scores[teamAName] = 0;
                    gameState.scores[teamBName] = 0;
                    gameState.scores[teamCName] = 0;
                } else {
                    const teamAName = document.getElementById('teamAName').value.trim() || 'Equipo A';
                    const teamBName = document.getElementById('teamBName').value.trim() || 'Equipo B';

                    gameState.teams = [
                        { name: teamAName, id: 'A' },
                        { name: teamBName, id: 'B' }
                    ];

                    gameState.scores[teamAName] = 0;
                    gameState.scores[teamBName] = 0;
                }

                console.log('Equipos:', gameState.teams);
            } else {
                // Juego individual: cada jugador tiene su puntuaci√≥n
                gameState.players.forEach(player => {
                    gameState.scores[player.name] = 0;
                });

                console.log('Jugadores individuales:', gameState.players);
            }

            console.log('Scores inicializados:', gameState.scores);

            createTurnOrder();

            // AQU√ç EST√Å EL CAMBIO: Mostrar el bot√≥n din√°micamente generado
            document.getElementById('startWordBtn').style.display = 'block';
        }

        function createTurnOrder() {
            gameState.turnOrder = [];

            console.log('=== CREATE TURN ORDER ===');
            console.log('isTeamGame:', gameState.isTeamGame, 'teamConfig:', gameState.teamConfig);

            if (gameState.isTeamGame) {
                // Crear turnos para cada equipo por separado
                const teamTurns = {};

                if (gameState.teamConfig === '2x2') {
                    const playersA = gameState.players.filter(p => p.team === 'A');
                    const playersB = gameState.players.filter(p => p.team === 'B');

                    console.log('2x2 - Equipo A:', playersA, 'Equipo B:', playersB);

                    // Turnos para cada equipo
                    teamTurns.A = [
                        {
                            player: playersA[0],
                            guessers: [playersA[1]],
                            team: gameState.teams.find(t => t.id === 'A').name
                        },
                        {
                            player: playersA[1],
                            guessers: [playersA[0]],
                            team: gameState.teams.find(t => t.id === 'A').name
                        }
                    ];

                    teamTurns.B = [
                        {
                            player: playersB[0],
                            guessers: [playersB[1]],
                            team: gameState.teams.find(t => t.id === 'B').name
                        },
                        {
                            player: playersB[1],
                            guessers: [playersB[0]],
                            team: gameState.teams.find(t => t.id === 'B').name
                        }
                    ];

                    // Intercalar turnos: A1, B1, A2, B2
                    const maxTurns = Math.max(teamTurns.A.length, teamTurns.B.length);
                    for (let i = 0; i < maxTurns; i++) {
                        if (teamTurns.A[i]) gameState.turnOrder.push(teamTurns.A[i]);
                        if (teamTurns.B[i]) gameState.turnOrder.push(teamTurns.B[i]);
                    }

                } else if (gameState.teamConfig === '2x3') {
                    const playersA = gameState.players.filter(p => p.team === 'A');
                    const playersB = gameState.players.filter(p => p.team === 'B');

                    console.log('2x3 - Equipo A:', playersA, 'Equipo B:', playersB);

                    // Turnos para cada equipo
                    teamTurns.A = [];
                    for (let i = 0; i < playersA.length; i++) {
                        const guessers = playersA.filter((_, index) => index !== i);
                        teamTurns.A.push({
                            player: playersA[i],
                            guessers: guessers,
                            team: gameState.teams.find(t => t.id === 'A').name
                        });
                    }

                    teamTurns.B = [];
                    for (let i = 0; i < playersB.length; i++) {
                        const guessers = playersB.filter((_, index) => index !== i);
                        teamTurns.B.push({
                            player: playersB[i],
                            guessers: guessers,
                            team: gameState.teams.find(t => t.id === 'B').name
                        });
                    }

                    // Intercalar turnos: A1, B1, A2, B2, A3, B3
                    const maxTurns = Math.max(teamTurns.A.length, teamTurns.B.length);
                    for (let i = 0; i < maxTurns; i++) {
                        if (teamTurns.A[i]) gameState.turnOrder.push(teamTurns.A[i]);
                        if (teamTurns.B[i]) gameState.turnOrder.push(teamTurns.B[i]);
                    }

                } else if (gameState.teamConfig === '3x2') {
                    const playersA = gameState.players.filter(p => p.team === 'A');
                    const playersB = gameState.players.filter(p => p.team === 'B');
                    const playersC = gameState.players.filter(p => p.team === 'C');

                    console.log('3x2 - Equipo A:', playersA, 'Equipo B:', playersB, 'Equipo C:', playersC);

                    // Turnos para cada equipo
                    teamTurns.A = [
                        {
                            player: playersA[0],
                            guessers: [playersA[1]],
                            team: gameState.teams.find(t => t.id === 'A').name
                        },
                        {
                            player: playersA[1],
                            guessers: [playersA[0]],
                            team: gameState.teams.find(t => t.id === 'A').name
                        }
                    ];

                    teamTurns.B = [
                        {
                            player: playersB[0],
                            guessers: [playersB[1]],
                            team: gameState.teams.find(t => t.id === 'B').name
                        },
                        {
                            player: playersB[1],
                            guessers: [playersB[0]],
                            team: gameState.teams.find(t => t.id === 'B').name
                        }
                    ];

                    teamTurns.C = [
                        {
                            player: playersC[0],
                            guessers: [playersC[1]],
                            team: gameState.teams.find(t => t.id === 'C').name
                        },
                        {
                            player: playersC[1],
                            guessers: [playersC[0]],
                            team: gameState.teams.find(t => t.id === 'C').name
                        }
                    ];

                    // Intercalar turnos: A1, B1, C1, A2, B2, C2
                    const maxTurns = Math.max(teamTurns.A.length, teamTurns.B.length, teamTurns.C.length);
                    for (let i = 0; i < maxTurns; i++) {
                        if (teamTurns.A[i]) gameState.turnOrder.push(teamTurns.A[i]);
                        if (teamTurns.B[i]) gameState.turnOrder.push(teamTurns.B[i]);
                        if (teamTurns.C[i]) gameState.turnOrder.push(teamTurns.C[i]);
                    }
                }
            } else {
                // Sin equipos: cada jugador hace adivinar al siguiente (puntos compartidos)
                console.log('Creando turnos individuales para', gameState.players.length, 'jugadores');
                for (let i = 0; i < gameState.players.length; i++) {
                    const nextIndex = (i + 1) % gameState.players.length;
                    gameState.turnOrder.push({
                        player: gameState.players[i],
                        guessers: [gameState.players[nextIndex]],
                        team: null
                    });
                }
            }

            console.log('Orden de turnos creado:', gameState.turnOrder);
        }

        // ===== FUNCIONES DE ENTRADA DE PALABRAS =====
        function startWordEntry() {
            console.log('=== START WORD ENTRY ===');
            console.log('Estado actual:', gameState);

            if (gameState.players.length === 0) {
                alert('Error: No hay jugadores configurados');
                showScreen('playersScreen');
                return;
            }

            // REINICIAR VARIABLES DE PALABRAS
            gameState.allWords = [];
            gameState.currentPlayerIndex = 0;
            gameState.currentWordCount = 0;

            // CORRECCI√ìN: Restaurar visibilidad de elementos del DOM
            document.getElementById('wordInput').style.display = 'block';
            document.querySelector('.word-input-section').style.display = 'flex';
            document.querySelector('.word-counter').style.display = 'block';
            const addButton = document.querySelector('#wordsScreen .word-buttons .btn:not(.btn-warning)');
            if (addButton) addButton.style.display = 'block';
            document.getElementById('startGameBtn').style.display = 'none';
            document.getElementById('undoBtn').style.display = 'none';

            console.log('Iniciando entrada de palabras para', gameState.players.length, 'jugadores');

            // NUEVO: Inicializar lista de jugadores
            updatePlayersStatus();

            showWordEntry();
            showScreen('wordsScreen');
        }

        function showWordEntry() {
            if (gameState.currentPlayerIndex >= gameState.players.length) {
                console.error('√çndice fuera de rango:', gameState.currentPlayerIndex, 'Total:', gameState.players.length);
                return;
            }

            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const wordsForThisPlayer = gameState.currentWordCount % gameState.wordsPerPlayer;
            const wordNumber = wordsForThisPlayer + 1;

            console.log('Mostrando entrada para:', currentPlayer.name, 'Palabra:', wordNumber, 'de', gameState.wordsPerPlayer);

            // CORRECCI√ìN: Asegurar que los elementos est√©n visibles
            document.getElementById('wordInput').style.display = 'block';
            document.querySelector('.word-input-section').style.display = 'flex';
            document.querySelector('.word-counter').style.display = 'block';
            const addButton = document.querySelector('#wordsScreen .word-buttons .btn:not(.btn-warning)');
            if (addButton) addButton.style.display = 'block';

            // MEJORAR: Mejor informaci√≥n del jugador manteniendo estilo original
            document.getElementById('currentWordPlayer').textContent =
                `${currentPlayer.name}, introduce tus palabras`;

            document.getElementById('wordNumber').textContent = wordNumber;
            document.getElementById('totalWords').textContent = gameState.wordsPerPlayer;

            // NUEVO: Actualizar lista de jugadores
            updatePlayersStatus();

            document.getElementById('wordInput').value = '';
            document.getElementById('wordInput').focus();
        }

        function addWord() {
            const wordInput = document.getElementById('wordInput');
            const word = wordInput.value.trim();

            if (!word) {
                alert('Por favor, introduce una palabra');
                return;
            }

            if (gameState.allWords.some(w => w.toLowerCase() === word.toLowerCase())) {
                alert('Esta palabra ya ha sido introducida');
                return;
            }

            gameState.allWords.push(word);
            gameState.currentWordCount++;

            console.log('Palabra a√±adida:', word, 'Total:', gameState.allWords.length, 'Contador:', gameState.currentWordCount);

            // Mostrar bot√≥n deshacer despu√©s de a√±adir la primera palabra
            if (gameState.allWords.length > 0) {
                document.getElementById('undoBtn').style.display = 'block';
            }

            const wordsForThisPlayer = gameState.currentWordCount % gameState.wordsPerPlayer;

            if (wordsForThisPlayer === 0) {
                // Este jugador ha terminado sus palabras
                gameState.currentPlayerIndex++;
                console.log('Jugador completado, siguiente:', gameState.currentPlayerIndex, 'de', gameState.players.length);

                if (gameState.currentPlayerIndex >= gameState.players.length) {
                    // Todos los jugadores han terminado
                    console.log('Todos los jugadores completados. Palabras totales:', gameState.allWords);
                    document.getElementById('startGameBtn').style.display = 'block';

                    // CORREGIDO: Ocultar toda la secci√≥n de input cuando terminen todos
                    document.querySelector('.word-input-section').style.display = 'none';
                    document.querySelector('.word-counter').style.display = 'none';

                    document.getElementById('currentWordPlayer').textContent = '¬°Todas las palabras han sido introducidas!';

                    // NUEVO: Marcar todos como completados
                    updatePlayersStatus();
                    return;
                }
            }

            showWordEntry();
        }

        // ===== FUNCIONES DE JUEGO =====
        function startGame() {
            console.log('=== START GAME ===');
            console.log('Iniciando juego con', gameState.allWords.length, 'palabras');
            console.log('Palabras:', gameState.allWords);
            console.log('Orden de turnos:', gameState.turnOrder);

            if (gameState.allWords.length === 0) {
                alert('Error: No hay palabras para jugar');
                return;
            }

            if (gameState.turnOrder.length === 0) {
                alert('Error: No se ha configurado el orden de turnos');
                console.error('turnOrder vac√≠o!');
                return;
            }

            shuffleArray(gameState.allWords);
            gameState.remainingWords = [...gameState.allWords];
            gameState.roundWords[1] = [...gameState.allWords];
            gameState.currentRound = 1;
            gameState.currentTurnIndex = 0;

            console.log('Juego configurado. Preparando primer turno...');
            prepareNextTurn();
        }

        function prepareNextTurn() {
            console.log('=== PREPARE NEXT TURN ===');
            console.log('Palabras restantes:', gameState.remainingWords.length);
            console.log('Turno actual:', gameState.currentTurnIndex);

            if (gameState.remainingWords.length === 0) {
                console.log('No quedan palabras, finalizando ronda');
                endRound();
                return;
            }

            if (gameState.turnOrder.length === 0) {
                console.error('ERROR: turnOrder est√° vac√≠o!');
                alert('Error: No hay orden de turnos configurado');
                return;
            }

            const turn = gameState.turnOrder[gameState.currentTurnIndex % gameState.turnOrder.length];
            console.log('Turno actual:', turn);

            let guessersText;
            if (turn.guessers.length === 1) {
                guessersText = turn.guessers[0].name;
            } else {
                const names = turn.guessers.map(g => g.name);
                guessersText = names.slice(0, -1).join(', ') + ' y ' + names[names.length - 1];
            }

            document.getElementById('turnPlayerInfo').innerHTML =
                `<strong>${turn.player.name}</strong> hace adivinar a <strong>${guessersText}</strong>`;

            const rules = roundRules[gameState.currentRound];
            document.getElementById('turnRules').innerHTML = `
                                        <div class="rules-box">
                                            <h4>${rules.title}</h4>
                                            <p>${rules.description}</p>
                                        </div>
                                    `;

            showScreen('turnPrepScreen');
        }

        function startTurn() {
            console.log('=== START TURN ===');
            gameState.isPlaying = true;
            gameState.timeLeft = gameState.turnTime;
            gameState.hasPlayedWarningSound = false;

            const turn = gameState.turnOrder[gameState.currentTurnIndex % gameState.turnOrder.length];
            const rules = roundRules[gameState.currentRound];

            document.getElementById('roundTitle').textContent = rules.title;
            document.getElementById('roundDescription').textContent = rules.description;

            let guessersText;
            if (turn.guessers.length === 1) {
                guessersText = turn.guessers[0].name;
            } else {
                const names = turn.guessers.map(g => g.name);
                guessersText = names.slice(0, -1).join(', ') + ' y ' + names[names.length - 1];
            }

            document.getElementById('currentPlayer').textContent =
                `${turn.player.name} ‚Üí ${guessersText}`;

            document.getElementById('passBtn').style.display = rules.canPass ? 'inline-block' : 'none';

            const timerElement = document.getElementById('timer');
            timerElement.textContent = gameState.turnTime;
            timerElement.className = 'timer';
            timerElement.classList.remove('warning', 'danger');

            showNextWord();
            showScreen('gameScreen');

            setTimeout(() => {
                startTimer();
            }, 500);
        }

        function showNextWord() {
            console.log('=== SHOW NEXT WORD ===');
            console.log('Palabras restantes:', gameState.remainingWords.length);

            if (gameState.remainingWords.length === 0) {
                console.log('No quedan palabras, finalizando turno');
                endTurn();
                return;
            }

            const randomIndex = Math.floor(Math.random() * gameState.remainingWords.length);
            gameState.currentWord = gameState.remainingWords[randomIndex];

            console.log('Palabra seleccionada:', gameState.currentWord);

            const wordDisplay = document.getElementById('currentWordDisplay');
            wordDisplay.style.opacity = '0';

            setTimeout(() => {
                wordDisplay.textContent = gameState.currentWord;
                wordDisplay.style.opacity = '1';
                wordDisplay.classList.add('wordPop');
            }, 200);

            setTimeout(() => {
                wordDisplay.classList.remove('wordPop');
            }, 500);

            document.getElementById('wordsLeft').textContent = gameState.remainingWords.length;
        }

        function wordGuessed() {
            if (!gameState.isPlaying || !gameState.currentWord) return;

            console.log('=== WORD GUESSED ===');
            console.log('Palabra acertada:', gameState.currentWord);

            gameState.remainingWords = gameState.remainingWords.filter(w => w !== gameState.currentWord);

            const turn = gameState.turnOrder[gameState.currentTurnIndex % gameState.turnOrder.length];

            if (gameState.isTeamGame) {
                gameState.scores[turn.team]++;
                console.log('Punto para equipo:', turn.team, 'Total:', gameState.scores[turn.team]);
            } else {
                gameState.scores[turn.player.name]++;
                turn.guessers.forEach(guesser => {
                    gameState.scores[guesser.name]++;
                });
                console.log('Puntos compartidos:', turn.player.name, 'y', turn.guessers.map(g => g.name).join(', '));
            }

            showNextWord();
        }

        function passWord() {
            if (!gameState.isPlaying || !roundRules[gameState.currentRound].canPass) return;
            console.log('Palabra pasada:', gameState.currentWord);
            showNextWord();
        }

        function startTimer() {
            clearInterval(gameState.timer);

            gameState.timer = setInterval(() => {
                gameState.timeLeft--;

                const timerElement = document.getElementById('timer');
                timerElement.textContent = gameState.timeLeft;

                timerElement.classList.remove('warning', 'danger');

                if (gameState.timeLeft <= 5) {
                    timerElement.classList.add('danger');
                    if (!gameState.hasPlayedWarningSound) {
                        playBeepSound();
                        gameState.hasPlayedWarningSound = true;
                    }
                    if (gameState.timeLeft > 0) {
                        setTimeout(() => playBeepSound(), 100);
                    }
                } else if (gameState.timeLeft <= 10) {
                    timerElement.classList.add('warning');
                }

                if (gameState.timeLeft <= 0) {
                    // NUEVO: Sonido distintivo para tiempo agotado
                    playTimeUpSound();
                    endTurn();
                }
            }, 1000);
        }

        function endTurn() {
            console.log('=== END TURN ===');
            clearInterval(gameState.timer);
            gameState.isPlaying = false;
            gameState.timeLeft = gameState.turnTime;
            gameState.hasPlayedWarningSound = false;

            gameState.currentTurnIndex++;

            setTimeout(() => {
                prepareNextTurn();
            }, 1000);
        }

        function endRound() {
            console.log('=== END ROUND ===');
            clearInterval(gameState.timer);
            gameState.isPlaying = false;

            showRoundResults();
        }

        function showRoundResults() {
            document.getElementById('roundEndTitle').textContent = `üèÅ Fin de Ronda ${gameState.currentRound}`;

            let scoresHTML = '<h3>üìä Puntuaciones:</h3>';
            scoresHTML += '<table class="score-table">';
            scoresHTML += '<thead><tr><th>Jugador/Equipo</th><th>Puntos</th></tr></thead><tbody>';

            Object.entries(gameState.scores).forEach(([name, score]) => {
                scoresHTML += `<tr><td>${name}</td><td>${score}</td></tr>`;
            });

            scoresHTML += '</tbody></table>';

            document.getElementById('roundScores').innerHTML = scoresHTML;

            if (gameState.currentRound < 3) {
                document.getElementById('nextRoundBtn').style.display = 'block';
                document.getElementById('finalResultsBtn').style.display = 'none';
            } else {
                document.getElementById('nextRoundBtn').style.display = 'none';
                document.getElementById('finalResultsBtn').style.display = 'block';
            }

            showScreen('betweenRoundsScreen');
        }

        function startNextRound() {
            console.log('=== START NEXT ROUND ===');
            gameState.currentRound++;
            gameState.remainingWords = [...gameState.allWords];
            gameState.roundWords[gameState.currentRound] = [...gameState.allWords];
            // NO reseteamos currentTurnIndex - el c√≠rculo contin√∫a donde se qued√≥

            prepareNextTurn();
        }

        function showFinalResults() {
            let resultsHTML = '<table class="score-table">';
            resultsHTML += '<thead><tr><th>üèÜ Pos</th><th>Jugador/Equipo</th><th>Puntos</th></tr></thead><tbody>';

            const sortedScores = Object.entries(gameState.scores).sort((a, b) => b[1] - a[1]);

            sortedScores.forEach(([name, score], index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`;
                resultsHTML += `<tr><td>${medal}</td><td>${name}</td><td>${score}</td></tr>`;
            });

            resultsHTML += '</tbody></table>';

            document.getElementById('finalScores').innerHTML = resultsHTML;

            const winner = sortedScores[0];
            const winnerHTML = `<div class="winner">üéâ Ganador: ${winner[0]} (${winner[1]} puntos) üéâ</div>`;
            document.getElementById('winnerAnnouncement').innerHTML = winnerHTML;

            showScreen('resultsScreen');
        }

        // ===== FUNCIONES AUXILIARES =====
        function showScreen(screenId) {
            console.log('Mostrando pantalla:', screenId);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function restartGame() {
            gameState = {
                players: [],
                teams: [],
                isTeamGame: false,
                teamConfig: null,
                wordsPerPlayer: 6,
                turnTime: 30,
                currentRound: 1,
                currentPlayerIndex: 0,
                currentTurnIndex: 0,
                allWords: [],
                remainingWords: [],
                currentWord: null,
                scores: {},
                timer: null,
                timeLeft: 30,
                isPlaying: false,
                roundWords: { 1: [], 2: [], 3: [] },
                turnOrder: [],
                audioContext: null,
                hasPlayedWarningSound: false
            };

            clearInterval(gameState.timer);
            showScreen('setupScreen');
        }

        // ===== EVENT LISTENERS =====
        document.getElementById('wordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                addWord();
            }
        });

        window.addEventListener('beforeunload', function (e) {
            if (gameState.players.length > 0 && gameState.isPlaying) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            createFloatingParticles();
            setInterval(createFloatingParticles, 12000);
        });

        document.addEventListener('click', function () {
            initAudioContext();
        }, { once: true });
    </script>
</body>
</html>
